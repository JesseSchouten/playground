const glob = require('glob');
const YAML = require('yamljs');

const rootPrefix = './../../..';

const pythonFiles = [...glob.sync(`${rootPrefix}/databricks/peitho_shared/__init__.py`)];

const pythonUpdater = {
  readVersion: function (contents) {
    return YAML.parse(contents).version;
  },
  writeVersion: function (contents, version) {
    const output = "__version__ = " + `"${version}"` 

    return output;
  },
};

module.exports = {
  packageFiles: [
    {
      filename: `${rootPrefix}/VERSION.md`,
      type: 'plain-text',
    },
  ],
  bumpFiles: [
    {
      filename: `${rootPrefix}/VERSION.md`,
      type: 'plain-text',
    },
    ...pythonFiles.map(filename => ({ filename, updater: pythonUpdater })),
  ],
  infile: `${rootPrefix}/CHANGELOG.md`,
  releaseCommitMessageFormat: "chore(release): {{currentTag}}\n\nCommit generated by standard-version (https://www.npmjs.com/package/standard-version).",
  tagPrefix: "@dutchchannels/peitho@",
  skip: {
    tag: true,
  },
};
