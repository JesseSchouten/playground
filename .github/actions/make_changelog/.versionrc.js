const glob = require('glob');
const YAML = require('yamljs');

const rootPrefix = './../../..';

const yamlFiles = glob.sync(`${rootPrefix}/charts/*/Chart.yaml`);

const yamlUpdater = {
  readVersion: function (contents) {
    return YAML.parse(contents).version;
  },
  writeVersion: function (contents, version) {
    const json = {
      ...YAML.parse(contents),
      version,
      appVersion: version,
    };

    return YAML.stringify(json);
  },
};

module.exports = {
  packageFiles: [
    {
      filename: `${rootPrefix}/VERSION.md`,
      type: 'plain-text',
    },
  ],
  bumpFiles: [
    {
      filename: `${rootPrefix}/VERSION.md`,
      type: 'plain-text',
    },
    ...yamlFiles.map(filename => ({ filename, updater: yamlUpdater })),
  ],
  infile: `${rootPrefix}/CHANGELOG.md`,
  releaseCommitMessageFormat: "chore(release): {{currentTag}}\n\nCommit generated by standard-version (https://www.npmjs.com/package/standard-version).",
  tagPrefix: "@jesseschouten/playground@",
  skip: {
    tag: true,
  },
};
